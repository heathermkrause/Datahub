!function(e){window.NestedFormEvents=function(){this.addFields=e.proxy(this.addFields,this),this.removeFields=e.proxy(this.removeFields,this)},NestedFormEvents.prototype={addFields:function(t){var n=t.currentTarget,r=e(n).data("association"),i=e("#"+e(n).data("blueprint-id")),o=i.data("blueprint"),a=(e(n).closest(".fields").closestChild("input, textarea, select").eq(0).attr("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(a)for(var s=a.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],l=a.match(/[0-9]+/g)||[],u=0;u<s.length;u++)l[u]&&(o=o.replace(new RegExp("(_"+s[u]+")_.+?_","g"),"$1_"+l[u]+"_"),o=o.replace(new RegExp("(\\["+s[u]+"\\])\\[.+?\\]","g"),"$1["+l[u]+"]"));var c=new RegExp("new_"+r,"g"),p=this.newId();o=e.trim(o.replace(c,p));var f=this.insertFields(o,r,n);return f.trigger({type:"nested:fieldAdded",field:f}).trigger({type:"nested:fieldAdded:"+r,field:f}),!1},newId:function(){return(new Date).getTime()},insertFields:function(t,n,r){var i=e(r).data("target");return i?e(t).appendTo(e(i)):e(t).insertBefore(r)},removeFields:function(t){var n=e(t.currentTarget),r=n.data("association"),i=n.prev("input[type=hidden]");i.val("1");var o=n.closest(".fields");return o.hide(),o.trigger({type:"nested:fieldRemoved",field:o}).trigger({type:"nested:fieldRemoved:"+r,field:o}),!1}},window.nestedFormEvents=new NestedFormEvents,e(document).delegate("form a.add_nested_fields","click",nestedFormEvents.addFields).delegate("form a.remove_nested_fields","click",nestedFormEvents.removeFields)}(jQuery),/*
 * Copyright 2011, Tobias Lindig
 *
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 */
function(e){e.fn.closestChild=function(t){if(t&&""!=t){var n=[];for(n.push(this);n.length>0;)for(var r=n.shift(),i=r.children(),o=0;o<i.length;++o){var a=e(i[o]);if(a.is(t))return a;n.push(a)}}return e()}}(jQuery);